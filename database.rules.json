{
  "rules": {
    "otps": {
      "$email": {
        ".read": "auth !== null && auth.token.email === data.child('email').val()",
        ".write": "auth !== null && auth.token.email === newData.child('email').val()",
        ".validate": "newData.hasChildren(['code', 'timestamp', 'email'])",
        "email": {
          ".validate": "newData.val() === auth.token.email"
        },
        "timestamp": {
          ".validate": "newData.isNumber() && newData.val() <= now"
        },
        "code": {
          ".validate": "newData.isString() && newData.val().length === 6 && newData.val().matches(/^[0-9]{6}$/)"
        },
        ".indexOn": ["timestamp"],
        ".expires": "data.child('timestamp').val() + 300000"
      }
    },
    ".read": false,
    ".write": false
  }
} 